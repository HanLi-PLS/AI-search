# Quick Deployment Guide

## One-Command Deploy

SSH into your EC2 instance and run:

```bash
cd /opt/ai-search
git fetch origin
git checkout claude/evaluate-html-to-react-01D6i6R5AMZQrJChq2S5j3J1
git pull origin claude/evaluate-html-to-react-01D6i6R5AMZQrJChq2S5j3J1
./deploy_quick.sh
```

That's it! The script will:
1. ✅ Pull latest code
2. ✅ Update backend dependencies (slowapi)
3. ✅ Update frontend dependencies (dompurify)
4. ✅ Rebuild frontend
5. ✅ Configure security settings (auto-generate SECRET_KEY, prompt for domain)
6. ✅ Restart PM2 services
7. ✅ Show service status

## Manual Setup (If You Prefer)

If you want to run security setup separately:

```bash
cd /opt/ai-search
./setup_security.sh
```

This will:
- Auto-generate a secure SECRET_KEY
- Prompt for your domain(s) for CORS
- Set ENVIRONMENT=production
- Add rate limiting settings
- Update .env file automatically

## What the Scripts Do

### `setup_security.sh`
- Generates secure SECRET_KEY automatically
- Prompts for CORS_ORIGINS (your domain)
- Updates .env file with all security settings
- Backs up existing .env before changes
- No manual editing needed!

### `deploy_quick.sh`
- Complete deployment automation
- Runs all update steps
- Calls setup_security.sh automatically
- Restarts services
- Shows final status

## Rollback

If something goes wrong:

```bash
# Your old .env is backed up automatically
ls .env.backup.*

# Restore if needed
cp .env.backup.YYYYMMDD_HHMMSS .env

# Rollback code
git checkout <previous-commit>
pm2 restart all
```

## Verification

After deployment:

```bash
# Check services
pm2 status

# Check logs
pm2 logs --lines 50

# Look for these success messages:
# "Rate limiting enabled: 60/minute"
# "CORS enabled for origins: ['https://yourdomain.com']"
```

## Environment Variables Set by Script

The setup script automatically configures:

```bash
SECRET_KEY=<auto-generated-32-char-key>
CORS_ORIGINS=<your-domain-input>
CORS_ALLOW_CREDENTIALS=true
ENVIRONMENT=production
RATE_LIMIT_DEFAULT=60/minute
RATE_LIMIT_SEARCH=20/minute
RATE_LIMIT_UPLOAD=10/minute
RATE_LIMIT_AUTH=5/minute
```

All your existing variables (OPENAI_API_KEY, etc.) remain unchanged.

## No More Nano!

Just run the scripts and answer the prompts. Everything is automated.
